const insightsModule={getSleepLogs(){if(window.getStudiosData)return window.getStudiosData().sleepLogs||{};try{const e=localStorage.getItem("studios_sleepLogs");return e?JSON.parse(e):{}}catch(e){return{}}},getMoodData(){if(window.getStudiosData)return window.getStudiosData().moodData||{};try{const e=localStorage.getItem("studios_moodLogs");return e?JSON.parse(e):{}}catch(e){return{}}},analyzeSleepMoodCorrelation(){const e=this.getSleepLogs(),t=this.getMoodData(),n=Object.keys(e).filter(e=>void 0!==t[e]);if(n.length<7)return{message:`Need ${7-n.length} more days of data for insights`,correlation:0,dataPoints:n.length,ready:!1};const s=n.map(t=>e[t]),o=n.map(e=>this.moodToNumber(t[e])),r=this.calculatePearsonCorrelation(s,o),a=this.findOptimalSleepHours(e,t),i=s.reduce((e,t)=>e+t,0)/s.length;return{correlation:r,correlationPercent:Math.abs(100*r).toFixed(0),direction:r>0?"positive":"negative",message:this.generateMessage(r,a,i),recommendation:this.generateRecommendation(a,r,i),optimalSleep:a,averageSleep:i.toFixed(1),dataPoints:n.length,ready:!0}},moodToNumber:e=>({sad:1,stressed:2,neutral:3,happy:4,excited:5}[e]||3),calculatePearsonCorrelation(e,t){if(e.length!==t.length||e.length<2)return 0;const n=e.length,s=e.reduce((e,t)=>e+t,0)/n,o=t.reduce((e,t)=>e+t,0)/n;let r=0,a=0,i=0;for(let d=0;d<n;d++){const n=e[d]-s,l=t[d]-o;r+=n*l,a+=n*n,i+=l*l}const d=Math.sqrt(a*i);return 0===d?0:r/d},findOptimalSleepHours(e,t){const n={};Object.entries(e).forEach(([e,s])=>{const o=t[e];if(void 0===o)return;const r=this.moodToNumber(o),a=Math.round(s);n[a]||(n[a]=[]),n[a].push(r)});let s=7,o=0;return Object.entries(n).forEach(([e,t])=>{if(t.length<2)return;const n=t.reduce((e,t)=>e+t,0)/t.length;n>o&&(o=n,s=parseInt(e))}),s},generateMessage(e,t,n){const s=Math.abs(e),o=e>0?"better":"worse";return s<.2?"Your mood seems mostly independent of sleep duration. Keep tracking for more insights!":s<.5?`There's a moderate link between your sleep and mood. You tend to feel ${o} with ${t}+ hours.`:`Strong correlation detected! Your mood is ${Math.round(100*s)}% ${o} when you sleep around ${t} hours.`},generateRecommendation(e,t,n){const s=[];return Math.abs(t)<.2&&s.push("ðŸ“Š Keep logging sleep and mood to uncover patterns"),e<6?s.push("âš ï¸ Your optimal sleep seems low. Try gradually adding 15 min per night"):e>9?s.push("ðŸ’¡ You may benefit from 7-8 hours instead of oversleeping"):s.push(`âœ¨ Your sweet spot is ${e} hours. Try to stay consistent!`),n<e-1&&s.push(`ðŸ˜´ You're averaging ${n.toFixed(1)}h but feel best at ${e}h. Consider earlier bedtimes.`),s.join("\n")},getWeeklyTrend(){const e=this.getSleepLogs(),t=new Date,n=new Date(t.getTime()-6048e5),s=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,o=[];for(let r=new Date(n);r<=t;r.setDate(r.getDate()+1)){const t=s(r);o.push({date:t,day:r.toLocaleDateString("en-US",{weekday:"short"}),hours:e[t]||null})}return o},renderInsightsWidget(e="insights-widget-container"){const t=document.getElementById(e);if(!t)return;const n=this.analyzeSleepMoodCorrelation(),s=this.getWeeklyTrend().map(e=>{const t=e.hours?Math.min(e.hours/10*100,100):0;return`\n                <div class="flex flex-col items-center gap-1">\n                    <div class="w-4 h-16 bg-white/10 rounded-full relative overflow-hidden">\n                        <div class="${e.hours?e.hours>=7?"bg-tertiary":e.hours>=5?"bg-accent":"bg-danger":"bg-white/20"} absolute bottom-0 w-full rounded-full transition-all" style="height: ${t}%"></div>\n                    </div>\n                    <span class="text-[10px] text-text-muted">${e.day}</span>\n                </div>\n            `}).join("");t.innerHTML=`\n            <div class="space-y-4">\n                \x3c!-- Weekly Sleep Trend --\x3e\n                <div class="flex justify-between items-end gap-1 px-2">\n                    ${s}\n                </div>\n                \n                ${n.ready?`\n                    \x3c!-- Correlation Stats --\x3e\n                    <div class="grid grid-cols-2 gap-3 mt-3">\n                        <div class="bg-white/5 rounded-xl p-3 border border-glass-border">\n                            <div class="text-xs text-text-muted mb-1">Correlation</div>\n                            <div class="text-xl font-bold ${n.correlation>0?"text-tertiary":"text-danger"}">\n                                ${n.correlationPercent}%\n                                <span class="text-xs font-normal text-text-muted">${n.direction}</span>\n                            </div>\n                        </div>\n                        <div class="bg-white/5 rounded-xl p-3 border border-glass-border">\n                            <div class="text-xs text-text-muted mb-1">Optimal Sleep</div>\n                            <div class="text-xl font-bold text-primary">\n                                ${n.optimalSleep}h\n                                <span class="text-xs font-normal text-text-muted">avg: ${n.averageSleep}h</span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Insight Message --\x3e\n                    <div class="bg-primary/10 rounded-xl p-3 border border-primary/30">\n                        <p class="text-sm text-text-default">${n.message}</p>\n                    </div>\n                    \n                    \x3c!-- Recommendation --\x3e\n                    <div class="text-xs text-secondary whitespace-pre-line leading-relaxed">\n                        ${n.recommendation}\n                    </div>\n                `:`\n                    \x3c!-- Not Ready State --\x3e\n                    <div class="text-center py-4 bg-white/5 rounded-xl border border-glass-border">\n                        <div class="flex items-center justify-center gap-2 mb-2">\n                            <span class="material-symbols-outlined text-2xl text-secondary animate-pulse">hourglass_empty</span>\n                            <span class="text-3xl font-bold text-text-default">${n.dataPoints}/7</span>\n                        </div>\n                        <p class="text-sm text-text-muted">${n.message}</p>\n                        <p class="text-xs text-secondary mt-2">Log your sleep and mood daily to unlock insights!</p>\n                    </div>\n                `}\n            </div>\n        `},init(){this.renderInsightsWidget();const e=document.getElementById("refresh-insights-btn");e&&e.addEventListener("click",()=>{e.querySelector(".material-symbols-outlined").classList.add("animate-spin"),setTimeout(()=>{this.renderInsightsWidget(),e.querySelector(".material-symbols-outlined").classList.remove("animate-spin")},500)})}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>insightsModule.init()):insightsModule.init(),window.insightsModule=insightsModule;